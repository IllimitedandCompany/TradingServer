'use strict';
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
    try {
        var info = gen[key](arg);
        var value = info.value;
    } catch (error) {
        reject(error);
        return;
    }
    if (info.done) {
        resolve(value);
    } else {
        Promise.resolve(value).then(_next, _throw);
    }
}
function _async_to_generator(fn) {
    return function() {
        var self = this, args = arguments;
        return new Promise(function(resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
        });
    };
}
import fs from 'fs-extra';
import moment from 'moment';
import OptionsValidator from '../optionsValidator';
import LoggerManager from '../../logger';
let PacketLogger = class PacketLogger {
    _ensurePreviousPriceObject(accountId) {
        if (!this._previousPrices[accountId]) {
            this._previousPrices[accountId] = {};
        }
    }
    /**
   * Processes packets and pushes them into save queue
   * @param {Object} packet packet to log
   */ // eslint-disable-next-line complexity
    logPacket(packet) {
        const instanceIndex = packet.instanceIndex || 0;
        if (!this._writeQueue[packet.accountId]) {
            this._writeQueue[packet.accountId] = {
                isWriting: false,
                queue: []
            };
        }
        if (packet.type === 'status') {
            return;
        }
        if (!this._lastSNPacket[packet.accountId]) {
            this._lastSNPacket[packet.accountId] = {};
        }
        if ([
            'keepalive',
            'noop'
        ].includes(packet.type)) {
            this._lastSNPacket[packet.accountId][instanceIndex] = packet;
            return;
        }
        const queue = this._writeQueue[packet.accountId].queue;
        if (!this._previousPrices[packet.accountId]) {
            this._previousPrices[packet.accountId] = {};
        }
        const prevPrice = this._previousPrices[packet.accountId][instanceIndex];
        if (packet.type !== 'prices') {
            if (prevPrice) {
                this._recordPrices(packet.accountId, instanceIndex);
            }
            if (packet.type === 'specifications' && this._compressSpecifications) {
                queue.push(JSON.stringify({
                    type: packet.type,
                    sequenceNumber: packet.sequenceNumber,
                    sequenceTimestamp: packet.sequenceTimestamp,
                    instanceIndex
                }));
            } else {
                queue.push(JSON.stringify(packet));
            }
        } else {
            if (!this._compressPrices) {
                queue.push(JSON.stringify(packet));
            } else {
                if (prevPrice) {
                    const validSequenceNumbers = [
                        prevPrice.last.sequenceNumber,
                        prevPrice.last.sequenceNumber + 1
                    ];
                    if (this._lastSNPacket[packet.accountId][instanceIndex]) {
                        validSequenceNumbers.push(this._lastSNPacket[packet.accountId][instanceIndex].sequenceNumber + 1);
                    }
                    if (!validSequenceNumbers.includes(packet.sequenceNumber)) {
                        this._recordPrices(packet.accountId, instanceIndex);
                        this._ensurePreviousPriceObject(packet.accountId);
                        this._previousPrices[packet.accountId][instanceIndex] = {
                            first: packet,
                            last: packet
                        };
                        queue.push(JSON.stringify(packet));
                    } else {
                        this._previousPrices[packet.accountId][instanceIndex].last = packet;
                    }
                } else {
                    this._ensurePreviousPriceObject(packet.accountId);
                    this._previousPrices[packet.accountId][instanceIndex] = {
                        first: packet,
                        last: packet
                    };
                    queue.push(JSON.stringify(packet));
                }
            }
        }
    }
    /**
   * Returns log messages within date bounds as an array of objects
   * @param {String} accountId account id 
   * @param {Date} dateAfter date to get logs after
   * @param {Date} dateBefore date to get logs before
   * @returns {Array<Object>} log messages
   */ readLogs(accountId, dateAfter, dateBefore) {
        var _this = this;
        return _async_to_generator(function*() {
            const folders = yield fs.readdir(_this._root);
            const packets = [];
            for (let folder of folders){
                const filePath = `${_this._root}/${folder}/${accountId}.log`;
                if (yield fs.pathExists(filePath)) {
                    const contents = yield fs.readFile(filePath, 'utf8');
                    let messages = contents.split('\r\n').filter((message)=>message.length).map((message)=>{
                        return {
                            date: new Date(message.slice(1, 24)),
                            message: message.slice(26)
                        };
                    });
                    if (dateAfter) {
                        messages = messages.filter((message)=>message.date > dateAfter);
                    }
                    if (dateBefore) {
                        messages = messages.filter((message)=>message.date < dateBefore);
                    }
                    packets.push(...messages);
                }
            }
            return packets;
        })();
    }
    /**
   * Returns path for account log file
   * @param {String} accountId account id
   * @returns {String} file path
   */ getFilePath(accountId) {
        var _this = this;
        return _async_to_generator(function*() {
            const fileIndex = Math.floor(new Date().getHours() / _this._logFileSizeInHours);
            const folderName = `${moment().format('YYYY-MM-DD')}-${fileIndex > 9 ? fileIndex : '0' + fileIndex}`;
            yield fs.ensureDir(`${_this._root}/${folderName}`);
            return `${_this._root}/${folderName}/${accountId}.log`;
        })();
    }
    /**
   * Initializes the packet logger
   */ start() {
        this._previousPrices = {};
        if (!this._recordInteval) {
            this._recordInteval = setInterval(()=>this._appendLogs(), 1000);
            this._deleteOldLogsInterval = setInterval(()=>this._deleteOldData(), 10000);
        }
    }
    /**
   * Deinitializes the packet logger
   */ stop() {
        clearInterval(this._recordInteval);
        clearInterval(this._deleteOldLogsInterval);
    }
    /**
   * Records price packet messages to log files
   * @param {String} accountId account id
   */ _recordPrices(accountId, instanceNumber) {
        const prevPrice = this._previousPrices[accountId][instanceNumber] || {
            first: {},
            last: {}
        };
        const queue = this._writeQueue[accountId].queue;
        delete this._previousPrices[accountId][instanceNumber];
        if (!Object.keys(this._previousPrices[accountId]).length) {
            delete this._previousPrices[accountId];
        }
        if (prevPrice.first.sequenceNumber !== prevPrice.last.sequenceNumber) {
            queue.push(JSON.stringify(prevPrice.last));
            queue.push(`Recorded price packets ${prevPrice.first.sequenceNumber}` + `-${prevPrice.last.sequenceNumber}, instanceIndex: ${instanceNumber}`);
        }
    }
    /**
   * Writes logs to files
   */ _appendLogs() {
        var _this = this;
        return _async_to_generator(function*() {
            Object.keys(_this._writeQueue).forEach(function() {
                var _ref = _async_to_generator(function*(accountId) {
                    const queue = _this._writeQueue[accountId];
                    if (!queue.isWriting && queue.queue.length) {
                        queue.isWriting = true;
                        try {
                            const filePath = yield _this.getFilePath(accountId);
                            const writeString = queue.queue.reduce((a, b)=>a + `[${moment().format('YYYY-MM-DD HH:mm:ss.SSS')}] ${b}\r\n`, '');
                            queue.queue = [];
                            yield fs.appendFile(filePath, writeString);
                        } catch (err) {
                            _this._logger.error(`${accountId}: Failed to record packet log`, err);
                        }
                        queue.isWriting = false;
                    }
                });
                return function(accountId) {
                    return _ref.apply(this, arguments);
                };
            }());
        })();
    }
    /**
   * Deletes folders when the folder limit is exceeded
   */ _deleteOldData() {
        var _this = this;
        return _async_to_generator(function*() {
            const contents = yield fs.readdir(_this._root);
            contents.reverse().slice(_this._fileNumberLimit).forEach(function() {
                var _ref = _async_to_generator(function*(folderName) {
                    yield fs.remove(`${_this._root}/${folderName}`);
                });
                return function(folderName) {
                    return _ref.apply(this, arguments);
                };
            }());
        })();
    }
    /**
   * Constructs the class
   * @param {PacketLoggerOpts} opts packet logger options
   */ constructor(opts){
        const validator = new OptionsValidator();
        opts = opts || {};
        this._fileNumberLimit = validator.validateNonZero(opts.fileNumberLimit, 12, 'packetLogger.fileNumberLimit');
        this._logFileSizeInHours = validator.validateNonZero(opts.logFileSizeInHours, 4, 'packetLogger.logFileSizeInHours');
        this._compressSpecifications = validator.validateBoolean(opts.compressSpecifications, true, 'packetLogger.compressSpecifications');
        this._compressPrices = validator.validateBoolean(opts.compressPrices, true, 'packetLogger.compressPrices');
        this._previousPrices = {};
        this._lastSNPacket = {};
        this._writeQueue = {};
        this._root = './.metaapi/logs';
        this._logger = LoggerManager.getLogger('PacketLogger');
        fs.ensureDir(this._root);
    }
};
/**
 * Packet logger options
 * @typedef {Object} PacketLoggerOpts
 * @property {Boolean} [enabled] whether packet logger is enabled
 * @property {Number} [fileNumberLimit] maximum amount of files per account, default value is 12
 * @property {Number} [logFileSizeInHours] amount of logged hours per account file, default value is 4
 * @property {Boolean} [compressSpecifications] whether to compress specifications packets, default value is true
 * @property {Boolean} [compressPrices] whether to compress specifications packets, default value is true
 */ /**
 * A class which records packets into log files
 */ export { PacketLogger as default };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjxhbm9uPiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IE9wdGlvbnNWYWxpZGF0b3IgZnJvbSAnLi4vb3B0aW9uc1ZhbGlkYXRvcic7XG5pbXBvcnQgTG9nZ2VyTWFuYWdlciBmcm9tICcuLi8uLi9sb2dnZXInO1xuXG4vKipcbiAqIFBhY2tldCBsb2dnZXIgb3B0aW9uc1xuICogQHR5cGVkZWYge09iamVjdH0gUGFja2V0TG9nZ2VyT3B0c1xuICogQHByb3BlcnR5IHtCb29sZWFufSBbZW5hYmxlZF0gd2hldGhlciBwYWNrZXQgbG9nZ2VyIGlzIGVuYWJsZWRcbiAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbZmlsZU51bWJlckxpbWl0XSBtYXhpbXVtIGFtb3VudCBvZiBmaWxlcyBwZXIgYWNjb3VudCwgZGVmYXVsdCB2YWx1ZSBpcyAxMlxuICogQHByb3BlcnR5IHtOdW1iZXJ9IFtsb2dGaWxlU2l6ZUluSG91cnNdIGFtb3VudCBvZiBsb2dnZWQgaG91cnMgcGVyIGFjY291bnQgZmlsZSwgZGVmYXVsdCB2YWx1ZSBpcyA0XG4gKiBAcHJvcGVydHkge0Jvb2xlYW59IFtjb21wcmVzc1NwZWNpZmljYXRpb25zXSB3aGV0aGVyIHRvIGNvbXByZXNzIHNwZWNpZmljYXRpb25zIHBhY2tldHMsIGRlZmF1bHQgdmFsdWUgaXMgdHJ1ZVxuICogQHByb3BlcnR5IHtCb29sZWFufSBbY29tcHJlc3NQcmljZXNdIHdoZXRoZXIgdG8gY29tcHJlc3Mgc3BlY2lmaWNhdGlvbnMgcGFja2V0cywgZGVmYXVsdCB2YWx1ZSBpcyB0cnVlXG4gKi9cblxuLyoqXG4gKiBBIGNsYXNzIHdoaWNoIHJlY29yZHMgcGFja2V0cyBpbnRvIGxvZyBmaWxlc1xuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYWNrZXRMb2dnZXIge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIHRoZSBjbGFzc1xuICAgKiBAcGFyYW0ge1BhY2tldExvZ2dlck9wdHN9IG9wdHMgcGFja2V0IGxvZ2dlciBvcHRpb25zXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRzKSB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gbmV3IE9wdGlvbnNWYWxpZGF0b3IoKTtcbiAgICBvcHRzID0gb3B0cyB8fCB7fTtcbiAgICB0aGlzLl9maWxlTnVtYmVyTGltaXQgPSB2YWxpZGF0b3IudmFsaWRhdGVOb25aZXJvKG9wdHMuZmlsZU51bWJlckxpbWl0LCAxMiwgJ3BhY2tldExvZ2dlci5maWxlTnVtYmVyTGltaXQnKTtcbiAgICB0aGlzLl9sb2dGaWxlU2l6ZUluSG91cnMgPSB2YWxpZGF0b3IudmFsaWRhdGVOb25aZXJvKG9wdHMubG9nRmlsZVNpemVJbkhvdXJzLCA0LFxuICAgICAgJ3BhY2tldExvZ2dlci5sb2dGaWxlU2l6ZUluSG91cnMnKTtcbiAgICB0aGlzLl9jb21wcmVzc1NwZWNpZmljYXRpb25zID0gdmFsaWRhdG9yLnZhbGlkYXRlQm9vbGVhbihvcHRzLmNvbXByZXNzU3BlY2lmaWNhdGlvbnMsIHRydWUsXG4gICAgICAncGFja2V0TG9nZ2VyLmNvbXByZXNzU3BlY2lmaWNhdGlvbnMnKTtcbiAgICB0aGlzLl9jb21wcmVzc1ByaWNlcyA9ICB2YWxpZGF0b3IudmFsaWRhdGVCb29sZWFuKG9wdHMuY29tcHJlc3NQcmljZXMsIHRydWUsICdwYWNrZXRMb2dnZXIuY29tcHJlc3NQcmljZXMnKTtcbiAgICB0aGlzLl9wcmV2aW91c1ByaWNlcyA9IHt9O1xuICAgIHRoaXMuX2xhc3RTTlBhY2tldCA9IHt9O1xuICAgIHRoaXMuX3dyaXRlUXVldWUgPSB7fTtcbiAgICB0aGlzLl9yb290ID0gJy4vLm1ldGFhcGkvbG9ncyc7XG4gICAgdGhpcy5fbG9nZ2VyID0gTG9nZ2VyTWFuYWdlci5nZXRMb2dnZXIoJ1BhY2tldExvZ2dlcicpO1xuICAgIGZzLmVuc3VyZURpcih0aGlzLl9yb290KTtcbiAgfVxuXG4gIF9lbnN1cmVQcmV2aW91c1ByaWNlT2JqZWN0KGFjY291bnRJZCkge1xuICAgIGlmKCF0aGlzLl9wcmV2aW91c1ByaWNlc1thY2NvdW50SWRdKSB7XG4gICAgICB0aGlzLl9wcmV2aW91c1ByaWNlc1thY2NvdW50SWRdID0ge307XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3NlcyBwYWNrZXRzIGFuZCBwdXNoZXMgdGhlbSBpbnRvIHNhdmUgcXVldWVcbiAgICogQHBhcmFtIHtPYmplY3R9IHBhY2tldCBwYWNrZXQgdG8gbG9nXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eVxuICBsb2dQYWNrZXQocGFja2V0KSB7XG4gICAgY29uc3QgaW5zdGFuY2VJbmRleCA9IHBhY2tldC5pbnN0YW5jZUluZGV4IHx8IDA7XG4gICAgaWYoIXRoaXMuX3dyaXRlUXVldWVbcGFja2V0LmFjY291bnRJZF0pIHtcbiAgICAgIHRoaXMuX3dyaXRlUXVldWVbcGFja2V0LmFjY291bnRJZF0gPSB7aXNXcml0aW5nOiBmYWxzZSwgcXVldWU6IFtdfTtcbiAgICB9XG4gICAgaWYocGFja2V0LnR5cGUgPT09ICdzdGF0dXMnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmKCF0aGlzLl9sYXN0U05QYWNrZXRbcGFja2V0LmFjY291bnRJZF0pIHtcbiAgICAgIHRoaXMuX2xhc3RTTlBhY2tldFtwYWNrZXQuYWNjb3VudElkXSA9IHt9O1xuICAgIH1cbiAgICBpZihbJ2tlZXBhbGl2ZScsICdub29wJ10uaW5jbHVkZXMocGFja2V0LnR5cGUpKSB7XG4gICAgICB0aGlzLl9sYXN0U05QYWNrZXRbcGFja2V0LmFjY291bnRJZF1baW5zdGFuY2VJbmRleF0gPSBwYWNrZXQ7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHF1ZXVlID0gdGhpcy5fd3JpdGVRdWV1ZVtwYWNrZXQuYWNjb3VudElkXS5xdWV1ZTtcbiAgICBpZighdGhpcy5fcHJldmlvdXNQcmljZXNbcGFja2V0LmFjY291bnRJZF0pIHtcbiAgICAgIHRoaXMuX3ByZXZpb3VzUHJpY2VzW3BhY2tldC5hY2NvdW50SWRdID0ge307XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHByZXZQcmljZSA9IHRoaXMuX3ByZXZpb3VzUHJpY2VzW3BhY2tldC5hY2NvdW50SWRdW2luc3RhbmNlSW5kZXhdO1xuICAgIFxuICAgIGlmKHBhY2tldC50eXBlICE9PSAncHJpY2VzJykge1xuICAgICAgaWYocHJldlByaWNlKSB7XG4gICAgICAgIHRoaXMuX3JlY29yZFByaWNlcyhwYWNrZXQuYWNjb3VudElkLCBpbnN0YW5jZUluZGV4KTtcbiAgICAgIH1cbiAgICAgIGlmKHBhY2tldC50eXBlID09PSAnc3BlY2lmaWNhdGlvbnMnICYmIHRoaXMuX2NvbXByZXNzU3BlY2lmaWNhdGlvbnMpIHtcbiAgICAgICAgcXVldWUucHVzaChKU09OLnN0cmluZ2lmeSh7dHlwZTogcGFja2V0LnR5cGUsIHNlcXVlbmNlTnVtYmVyOiBwYWNrZXQuc2VxdWVuY2VOdW1iZXIsIFxuICAgICAgICAgIHNlcXVlbmNlVGltZXN0YW1wOiBwYWNrZXQuc2VxdWVuY2VUaW1lc3RhbXAsIGluc3RhbmNlSW5kZXh9KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWV1ZS5wdXNoKEpTT04uc3RyaW5naWZ5KHBhY2tldCkpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZighdGhpcy5fY29tcHJlc3NQcmljZXMpIHtcbiAgICAgICAgcXVldWUucHVzaChKU09OLnN0cmluZ2lmeShwYWNrZXQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmKHByZXZQcmljZSkge1xuICAgICAgICAgIGNvbnN0IHZhbGlkU2VxdWVuY2VOdW1iZXJzID0gW3ByZXZQcmljZS5sYXN0LnNlcXVlbmNlTnVtYmVyLCBwcmV2UHJpY2UubGFzdC5zZXF1ZW5jZU51bWJlciArIDFdO1xuICAgICAgICAgIGlmKHRoaXMuX2xhc3RTTlBhY2tldFtwYWNrZXQuYWNjb3VudElkXVtpbnN0YW5jZUluZGV4XSkge1xuICAgICAgICAgICAgdmFsaWRTZXF1ZW5jZU51bWJlcnMucHVzaCh0aGlzLl9sYXN0U05QYWNrZXRbcGFja2V0LmFjY291bnRJZF1baW5zdGFuY2VJbmRleF0uc2VxdWVuY2VOdW1iZXIgKyAxKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoIXZhbGlkU2VxdWVuY2VOdW1iZXJzLmluY2x1ZGVzKHBhY2tldC5zZXF1ZW5jZU51bWJlcikpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlY29yZFByaWNlcyhwYWNrZXQuYWNjb3VudElkLCBpbnN0YW5jZUluZGV4KTtcbiAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVByZXZpb3VzUHJpY2VPYmplY3QocGFja2V0LmFjY291bnRJZCk7XG4gICAgICAgICAgICB0aGlzLl9wcmV2aW91c1ByaWNlc1twYWNrZXQuYWNjb3VudElkXVtpbnN0YW5jZUluZGV4XSA9IHtmaXJzdDogcGFja2V0LCBsYXN0OiBwYWNrZXR9O1xuICAgICAgICAgICAgcXVldWUucHVzaChKU09OLnN0cmluZ2lmeShwYWNrZXQpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fcHJldmlvdXNQcmljZXNbcGFja2V0LmFjY291bnRJZF1baW5zdGFuY2VJbmRleF0ubGFzdCA9IHBhY2tldDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fZW5zdXJlUHJldmlvdXNQcmljZU9iamVjdChwYWNrZXQuYWNjb3VudElkKTtcbiAgICAgICAgICB0aGlzLl9wcmV2aW91c1ByaWNlc1twYWNrZXQuYWNjb3VudElkXVtpbnN0YW5jZUluZGV4XSA9IHtmaXJzdDogcGFja2V0LCBsYXN0OiBwYWNrZXR9O1xuICAgICAgICAgIHF1ZXVlLnB1c2goSlNPTi5zdHJpbmdpZnkocGFja2V0KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBsb2cgbWVzc2FnZXMgd2l0aGluIGRhdGUgYm91bmRzIGFzIGFuIGFycmF5IG9mIG9iamVjdHNcbiAgICogQHBhcmFtIHtTdHJpbmd9IGFjY291bnRJZCBhY2NvdW50IGlkIFxuICAgKiBAcGFyYW0ge0RhdGV9IGRhdGVBZnRlciBkYXRlIHRvIGdldCBsb2dzIGFmdGVyXG4gICAqIEBwYXJhbSB7RGF0ZX0gZGF0ZUJlZm9yZSBkYXRlIHRvIGdldCBsb2dzIGJlZm9yZVxuICAgKiBAcmV0dXJucyB7QXJyYXk8T2JqZWN0Pn0gbG9nIG1lc3NhZ2VzXG4gICAqL1xuICBhc3luYyByZWFkTG9ncyhhY2NvdW50SWQsIGRhdGVBZnRlciwgZGF0ZUJlZm9yZSkge1xuICAgIGNvbnN0IGZvbGRlcnMgPSBhd2FpdCBmcy5yZWFkZGlyKHRoaXMuX3Jvb3QpO1xuICAgIGNvbnN0IHBhY2tldHMgPSBbXTtcblxuICAgIGZvciAobGV0IGZvbGRlciBvZiBmb2xkZXJzKSB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMuX3Jvb3R9LyR7Zm9sZGVyfS8ke2FjY291bnRJZH0ubG9nYDtcbiAgICAgIGlmKGF3YWl0IGZzLnBhdGhFeGlzdHMoZmlsZVBhdGgpKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnRzID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgsICd1dGY4Jyk7XG4gICAgICAgIGxldCBtZXNzYWdlcyA9IGNvbnRlbnRzLnNwbGl0KCdcXHJcXG4nKS5maWx0ZXIobWVzc2FnZSA9PiBtZXNzYWdlLmxlbmd0aCkubWFwKG1lc3NhZ2UgPT4ge1xuICAgICAgICAgIHJldHVybiB7ZGF0ZTogbmV3IERhdGUobWVzc2FnZS5zbGljZSgxLCAyNCkpLCBtZXNzYWdlOiBtZXNzYWdlLnNsaWNlKDI2KX07XG4gICAgICAgIH0pO1xuICAgICAgICBpZihkYXRlQWZ0ZXIpIHtcbiAgICAgICAgICBtZXNzYWdlcyA9IG1lc3NhZ2VzLmZpbHRlcihtZXNzYWdlID0+IG1lc3NhZ2UuZGF0ZSA+IGRhdGVBZnRlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZGF0ZUJlZm9yZSkge1xuICAgICAgICAgIG1lc3NhZ2VzID0gbWVzc2FnZXMuZmlsdGVyKG1lc3NhZ2UgPT4gbWVzc2FnZS5kYXRlIDwgZGF0ZUJlZm9yZSk7XG4gICAgICAgIH1cbiAgICAgICAgcGFja2V0cy5wdXNoKC4uLm1lc3NhZ2VzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcGFja2V0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHBhdGggZm9yIGFjY291bnQgbG9nIGZpbGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGFjY291bnRJZCBhY2NvdW50IGlkXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IGZpbGUgcGF0aFxuICAgKi9cbiAgYXN5bmMgZ2V0RmlsZVBhdGgoYWNjb3VudElkKSB7XG4gICAgY29uc3QgZmlsZUluZGV4ID0gTWF0aC5mbG9vcihuZXcgRGF0ZSgpLmdldEhvdXJzKCkgLyB0aGlzLl9sb2dGaWxlU2l6ZUluSG91cnMpO1xuICAgIGNvbnN0IGZvbGRlck5hbWUgPSBgJHttb21lbnQoKS5mb3JtYXQoJ1lZWVktTU0tREQnKX0tJHtmaWxlSW5kZXggPiA5ID8gZmlsZUluZGV4IDogJzAnICsgZmlsZUluZGV4fWA7XG4gICAgYXdhaXQgZnMuZW5zdXJlRGlyKGAke3RoaXMuX3Jvb3R9LyR7Zm9sZGVyTmFtZX1gKTtcbiAgICByZXR1cm4gYCR7dGhpcy5fcm9vdH0vJHtmb2xkZXJOYW1lfS8ke2FjY291bnRJZH0ubG9nYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgcGFja2V0IGxvZ2dlclxuICAgKi9cbiAgc3RhcnQoKSB7XG4gICAgdGhpcy5fcHJldmlvdXNQcmljZXMgPSB7fTtcbiAgICBpZiAoIXRoaXMuX3JlY29yZEludGV2YWwpIHtcbiAgICAgIHRoaXMuX3JlY29yZEludGV2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLl9hcHBlbmRMb2dzKCksIDEwMDApO1xuICAgICAgdGhpcy5fZGVsZXRlT2xkTG9nc0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy5fZGVsZXRlT2xkRGF0YSgpLCAxMDAwMCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlaW5pdGlhbGl6ZXMgdGhlIHBhY2tldCBsb2dnZXJcbiAgICovXG4gIHN0b3AoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9yZWNvcmRJbnRldmFsKTtcbiAgICBjbGVhckludGVydmFsKHRoaXMuX2RlbGV0ZU9sZExvZ3NJbnRlcnZhbCk7XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkcyBwcmljZSBwYWNrZXQgbWVzc2FnZXMgdG8gbG9nIGZpbGVzXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBhY2NvdW50SWQgYWNjb3VudCBpZFxuICAgKi9cbiAgX3JlY29yZFByaWNlcyhhY2NvdW50SWQsIGluc3RhbmNlTnVtYmVyKSB7XG4gICAgY29uc3QgcHJldlByaWNlID0gdGhpcy5fcHJldmlvdXNQcmljZXNbYWNjb3VudElkXVtpbnN0YW5jZU51bWJlcl0gfHwge2ZpcnN0OiB7fSwgbGFzdDp7fX07XG4gICAgY29uc3QgcXVldWUgPSB0aGlzLl93cml0ZVF1ZXVlW2FjY291bnRJZF0ucXVldWU7XG4gICAgZGVsZXRlIHRoaXMuX3ByZXZpb3VzUHJpY2VzW2FjY291bnRJZF1baW5zdGFuY2VOdW1iZXJdO1xuICAgIGlmKCFPYmplY3Qua2V5cyh0aGlzLl9wcmV2aW91c1ByaWNlc1thY2NvdW50SWRdKS5sZW5ndGgpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLl9wcmV2aW91c1ByaWNlc1thY2NvdW50SWRdO1xuICAgIH1cbiAgICBpZihwcmV2UHJpY2UuZmlyc3Quc2VxdWVuY2VOdW1iZXIgIT09IHByZXZQcmljZS5sYXN0LnNlcXVlbmNlTnVtYmVyKSB7XG4gICAgICBxdWV1ZS5wdXNoKEpTT04uc3RyaW5naWZ5KHByZXZQcmljZS5sYXN0KSk7XG4gICAgICBxdWV1ZS5wdXNoKGBSZWNvcmRlZCBwcmljZSBwYWNrZXRzICR7cHJldlByaWNlLmZpcnN0LnNlcXVlbmNlTnVtYmVyfWAgK1xuICAgICAgICBgLSR7cHJldlByaWNlLmxhc3Quc2VxdWVuY2VOdW1iZXJ9LCBpbnN0YW5jZUluZGV4OiAke2luc3RhbmNlTnVtYmVyfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBXcml0ZXMgbG9ncyB0byBmaWxlc1xuICAgKi9cbiAgYXN5bmMgX2FwcGVuZExvZ3MoKSB7XG4gICAgT2JqZWN0LmtleXModGhpcy5fd3JpdGVRdWV1ZSkuZm9yRWFjaChhc3luYyBhY2NvdW50SWQgPT4ge1xuICAgICAgY29uc3QgcXVldWUgPSB0aGlzLl93cml0ZVF1ZXVlW2FjY291bnRJZF07XG4gICAgICBpZiAoIXF1ZXVlLmlzV3JpdGluZyAmJiBxdWV1ZS5xdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgcXVldWUuaXNXcml0aW5nID0gdHJ1ZTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGF3YWl0IHRoaXMuZ2V0RmlsZVBhdGgoYWNjb3VudElkKTtcbiAgICAgICAgICBjb25zdCB3cml0ZVN0cmluZyA9IHF1ZXVlLnF1ZXVlLnJlZHVjZSgoYSxiKSA9PiBhICsgXG4gICAgICAgICAgYFske21vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcy5TU1MnKX1dICR7Yn1cXHJcXG5gICwnJyk7XG4gICAgICAgICAgcXVldWUucXVldWUgPSBbXTtcbiAgICAgICAgICBhd2FpdCBmcy5hcHBlbmRGaWxlKGZpbGVQYXRoLCB3cml0ZVN0cmluZyk7ICBcbiAgICAgICAgfSBjYXRjaChlcnIpIHtcbiAgICAgICAgICB0aGlzLl9sb2dnZXIuZXJyb3IoYCR7YWNjb3VudElkfTogRmFpbGVkIHRvIHJlY29yZCBwYWNrZXQgbG9nYCwgZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBxdWV1ZS5pc1dyaXRpbmcgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGZvbGRlcnMgd2hlbiB0aGUgZm9sZGVyIGxpbWl0IGlzIGV4Y2VlZGVkXG4gICAqL1xuICBhc3luYyBfZGVsZXRlT2xkRGF0YSgpIHtcbiAgICBjb25zdCBjb250ZW50cyA9IGF3YWl0IGZzLnJlYWRkaXIodGhpcy5fcm9vdCk7XG4gICAgY29udGVudHMucmV2ZXJzZSgpLnNsaWNlKHRoaXMuX2ZpbGVOdW1iZXJMaW1pdCkuZm9yRWFjaChhc3luYyBmb2xkZXJOYW1lID0+IHtcbiAgICAgIGF3YWl0IGZzLnJlbW92ZShgJHt0aGlzLl9yb290fS8ke2ZvbGRlck5hbWV9YCk7IFxuICAgIH0pO1xuICB9XG5cbn1cbiJdLCJuYW1lcyI6WyJmcyIsIm1vbWVudCIsIk9wdGlvbnNWYWxpZGF0b3IiLCJMb2dnZXJNYW5hZ2VyIiwiUGFja2V0TG9nZ2VyIiwiX2Vuc3VyZVByZXZpb3VzUHJpY2VPYmplY3QiLCJhY2NvdW50SWQiLCJfcHJldmlvdXNQcmljZXMiLCJsb2dQYWNrZXQiLCJwYWNrZXQiLCJpbnN0YW5jZUluZGV4IiwiX3dyaXRlUXVldWUiLCJpc1dyaXRpbmciLCJxdWV1ZSIsInR5cGUiLCJfbGFzdFNOUGFja2V0IiwiaW5jbHVkZXMiLCJwcmV2UHJpY2UiLCJfcmVjb3JkUHJpY2VzIiwiX2NvbXByZXNzU3BlY2lmaWNhdGlvbnMiLCJwdXNoIiwiSlNPTiIsInN0cmluZ2lmeSIsInNlcXVlbmNlTnVtYmVyIiwic2VxdWVuY2VUaW1lc3RhbXAiLCJfY29tcHJlc3NQcmljZXMiLCJ2YWxpZFNlcXVlbmNlTnVtYmVycyIsImxhc3QiLCJmaXJzdCIsInJlYWRMb2dzIiwiZGF0ZUFmdGVyIiwiZGF0ZUJlZm9yZSIsImZvbGRlcnMiLCJyZWFkZGlyIiwiX3Jvb3QiLCJwYWNrZXRzIiwiZm9sZGVyIiwiZmlsZVBhdGgiLCJwYXRoRXhpc3RzIiwiY29udGVudHMiLCJyZWFkRmlsZSIsIm1lc3NhZ2VzIiwic3BsaXQiLCJmaWx0ZXIiLCJtZXNzYWdlIiwibGVuZ3RoIiwibWFwIiwiZGF0ZSIsIkRhdGUiLCJzbGljZSIsImdldEZpbGVQYXRoIiwiZmlsZUluZGV4IiwiTWF0aCIsImZsb29yIiwiZ2V0SG91cnMiLCJfbG9nRmlsZVNpemVJbkhvdXJzIiwiZm9sZGVyTmFtZSIsImZvcm1hdCIsImVuc3VyZURpciIsInN0YXJ0IiwiX3JlY29yZEludGV2YWwiLCJzZXRJbnRlcnZhbCIsIl9hcHBlbmRMb2dzIiwiX2RlbGV0ZU9sZExvZ3NJbnRlcnZhbCIsIl9kZWxldGVPbGREYXRhIiwic3RvcCIsImNsZWFySW50ZXJ2YWwiLCJpbnN0YW5jZU51bWJlciIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwid3JpdGVTdHJpbmciLCJyZWR1Y2UiLCJhIiwiYiIsImFwcGVuZEZpbGUiLCJlcnIiLCJfbG9nZ2VyIiwiZXJyb3IiLCJyZXZlcnNlIiwiX2ZpbGVOdW1iZXJMaW1pdCIsInJlbW92ZSIsImNvbnN0cnVjdG9yIiwib3B0cyIsInZhbGlkYXRvciIsInZhbGlkYXRlTm9uWmVybyIsImZpbGVOdW1iZXJMaW1pdCIsImxvZ0ZpbGVTaXplSW5Ib3VycyIsInZhbGlkYXRlQm9vbGVhbiIsImNvbXByZXNzU3BlY2lmaWNhdGlvbnMiLCJjb21wcmVzc1ByaWNlcyIsImdldExvZ2dlciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBLE9BQU9BLFFBQVEsV0FBVztBQUMxQixPQUFPQyxZQUFZLFNBQVM7QUFDNUIsT0FBT0Msc0JBQXNCLHNCQUFzQjtBQUNuRCxPQUFPQyxtQkFBbUIsZUFBZTtBQWUxQixJQUFBLEFBQU1DLGVBQU4sTUFBTUE7SUF1Qm5CQywyQkFBMkJDLFNBQVMsRUFBRTtRQUNwQyxJQUFHLENBQUMsSUFBSSxDQUFDQyxlQUFlLENBQUNELFVBQVUsRUFBRTtZQUNuQyxJQUFJLENBQUNDLGVBQWUsQ0FBQ0QsVUFBVSxHQUFHLENBQUM7UUFDckM7SUFDRjtJQUVBOzs7R0FHQyxHQUNELHNDQUFzQztJQUN0Q0UsVUFBVUMsTUFBTSxFQUFF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