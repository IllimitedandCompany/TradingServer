"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return PacketLogger;
    }
});
const _fsextra = /*#__PURE__*/ _interop_require_default(require("fs-extra"));
const _moment = /*#__PURE__*/ _interop_require_default(require("moment"));
const _optionsValidator = /*#__PURE__*/ _interop_require_default(require("../optionsValidator"));
const _logger = /*#__PURE__*/ _interop_require_default(require("../../logger"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
let PacketLogger = class PacketLogger {
    _ensurePreviousPriceObject(accountId) {
        if (!this._previousPrices[accountId]) {
            this._previousPrices[accountId] = {};
        }
    }
    /**
   * Processes packets and pushes them into save queue
   * @param {Object} packet packet to log
   */ // eslint-disable-next-line complexity
    logPacket(packet) {
        const instanceIndex = packet.instanceIndex || 0;
        if (!this._writeQueue[packet.accountId]) {
            this._writeQueue[packet.accountId] = {
                isWriting: false,
                queue: []
            };
        }
        if (packet.type === "status") {
            return;
        }
        if (!this._lastSNPacket[packet.accountId]) {
            this._lastSNPacket[packet.accountId] = {};
        }
        if ([
            "keepalive",
            "noop"
        ].includes(packet.type)) {
            this._lastSNPacket[packet.accountId][instanceIndex] = packet;
            return;
        }
        const queue = this._writeQueue[packet.accountId].queue;
        if (!this._previousPrices[packet.accountId]) {
            this._previousPrices[packet.accountId] = {};
        }
        const prevPrice = this._previousPrices[packet.accountId][instanceIndex];
        if (packet.type !== "prices") {
            if (prevPrice) {
                this._recordPrices(packet.accountId, instanceIndex);
            }
            if (packet.type === "specifications" && this._compressSpecifications) {
                queue.push(JSON.stringify({
                    type: packet.type,
                    sequenceNumber: packet.sequenceNumber,
                    sequenceTimestamp: packet.sequenceTimestamp,
                    instanceIndex
                }));
            } else {
                queue.push(JSON.stringify(packet));
            }
        } else {
            if (!this._compressPrices) {
                queue.push(JSON.stringify(packet));
            } else {
                if (prevPrice) {
                    const validSequenceNumbers = [
                        prevPrice.last.sequenceNumber,
                        prevPrice.last.sequenceNumber + 1
                    ];
                    if (this._lastSNPacket[packet.accountId][instanceIndex]) {
                        validSequenceNumbers.push(this._lastSNPacket[packet.accountId][instanceIndex].sequenceNumber + 1);
                    }
                    if (!validSequenceNumbers.includes(packet.sequenceNumber)) {
                        this._recordPrices(packet.accountId, instanceIndex);
                        this._ensurePreviousPriceObject(packet.accountId);
                        this._previousPrices[packet.accountId][instanceIndex] = {
                            first: packet,
                            last: packet
                        };
                        queue.push(JSON.stringify(packet));
                    } else {
                        this._previousPrices[packet.accountId][instanceIndex].last = packet;
                    }
                } else {
                    this._ensurePreviousPriceObject(packet.accountId);
                    this._previousPrices[packet.accountId][instanceIndex] = {
                        first: packet,
                        last: packet
                    };
                    queue.push(JSON.stringify(packet));
                }
            }
        }
    }
    /**
   * Returns log messages within date bounds as an array of objects
   * @param {String} accountId account id 
   * @param {Date} dateAfter date to get logs after
   * @param {Date} dateBefore date to get logs before
   * @returns {Array<Object>} log messages
   */ async readLogs(accountId, dateAfter, dateBefore) {
        const folders = await _fsextra.default.readdir(this._root);
        const packets = [];
        for (let folder of folders){
            const filePath = `${this._root}/${folder}/${accountId}.log`;
            if (await _fsextra.default.pathExists(filePath)) {
                const contents = await _fsextra.default.readFile(filePath, "utf8");
                let messages = contents.split("\r\n").filter((message)=>message.length).map((message)=>{
                    return {
                        date: new Date(message.slice(1, 24)),
                        message: message.slice(26)
                    };
                });
                if (dateAfter) {
                    messages = messages.filter((message)=>message.date > dateAfter);
                }
                if (dateBefore) {
                    messages = messages.filter((message)=>message.date < dateBefore);
                }
                packets.push(...messages);
            }
        }
        return packets;
    }
    /**
   * Returns path for account log file
   * @param {String} accountId account id
   * @returns {String} file path
   */ async getFilePath(accountId) {
        const fileIndex = Math.floor(new Date().getHours() / this._logFileSizeInHours);
        const folderName = `${(0, _moment.default)().format("YYYY-MM-DD")}-${fileIndex > 9 ? fileIndex : "0" + fileIndex}`;
        await _fsextra.default.ensureDir(`${this._root}/${folderName}`);
        return `${this._root}/${folderName}/${accountId}.log`;
    }
    /**
   * Initializes the packet logger
   */ start() {
        this._previousPrices = {};
        if (!this._recordInteval) {
            this._recordInteval = setInterval(()=>this._appendLogs(), 1000);
            this._deleteOldLogsInterval = setInterval(()=>this._deleteOldData(), 10000);
        }
    }
    /**
   * Deinitializes the packet logger
   */ stop() {
        clearInterval(this._recordInteval);
        clearInterval(this._deleteOldLogsInterval);
    }
    /**
   * Records price packet messages to log files
   * @param {String} accountId account id
   */ _recordPrices(accountId, instanceNumber) {
        const prevPrice = this._previousPrices[accountId][instanceNumber] || {
            first: {},
            last: {}
        };
        const queue = this._writeQueue[accountId].queue;
        delete this._previousPrices[accountId][instanceNumber];
        if (!Object.keys(this._previousPrices[accountId]).length) {
            delete this._previousPrices[accountId];
        }
        if (prevPrice.first.sequenceNumber !== prevPrice.last.sequenceNumber) {
            queue.push(JSON.stringify(prevPrice.last));
            queue.push(`Recorded price packets ${prevPrice.first.sequenceNumber}` + `-${prevPrice.last.sequenceNumber}, instanceIndex: ${instanceNumber}`);
        }
    }
    /**
   * Writes logs to files
   */ async _appendLogs() {
        Object.keys(this._writeQueue).forEach(async (accountId)=>{
            const queue = this._writeQueue[accountId];
            if (!queue.isWriting && queue.queue.length) {
                queue.isWriting = true;
                try {
                    const filePath = await this.getFilePath(accountId);
                    const writeString = queue.queue.reduce((a, b)=>a + `[${(0, _moment.default)().format("YYYY-MM-DD HH:mm:ss.SSS")}] ${b}\r\n`, "");
                    queue.queue = [];
                    await _fsextra.default.appendFile(filePath, writeString);
                } catch (err) {
                    this._logger.error(`${accountId}: Failed to record packet log`, err);
                }
                queue.isWriting = false;
            }
        });
    }
    /**
   * Deletes folders when the folder limit is exceeded
   */ async _deleteOldData() {
        const contents = await _fsextra.default.readdir(this._root);
        contents.reverse().slice(this._fileNumberLimit).forEach(async (folderName)=>{
            await _fsextra.default.remove(`${this._root}/${folderName}`);
        });
    }
    /**
   * Constructs the class
   * @param {PacketLoggerOpts} opts packet logger options
   */ constructor(opts){
        const validator = new _optionsValidator.default();
        opts = opts || {};
        this._fileNumberLimit = validator.validateNonZero(opts.fileNumberLimit, 12, "packetLogger.fileNumberLimit");
        this._logFileSizeInHours = validator.validateNonZero(opts.logFileSizeInHours, 4, "packetLogger.logFileSizeInHours");
        this._compressSpecifications = validator.validateBoolean(opts.compressSpecifications, true, "packetLogger.compressSpecifications");
        this._compressPrices = validator.validateBoolean(opts.compressPrices, true, "packetLogger.compressPrices");
        this._previousPrices = {};
        this._lastSNPacket = {};
        this._writeQueue = {};
        this._root = "./.metaapi/logs";
        this._logger = _logger.default.getLogger("PacketLogger");
        _fsextra.default.ensureDir(this._root);
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjxhbm9uPiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IE9wdGlvbnNWYWxpZGF0b3IgZnJvbSAnLi4vb3B0aW9uc1ZhbGlkYXRvcic7XG5pbXBvcnQgTG9nZ2VyTWFuYWdlciBmcm9tICcuLi8uLi9sb2dnZXInO1xuXG4vKipcbiAqIFBhY2tldCBsb2dnZXIgb3B0aW9uc1xuICogQHR5cGVkZWYge09iamVjdH0gUGFja2V0TG9nZ2VyT3B0c1xuICogQHByb3BlcnR5IHtCb29sZWFufSBbZW5hYmxlZF0gd2hldGhlciBwYWNrZXQgbG9nZ2VyIGlzIGVuYWJsZWRcbiAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbZmlsZU51bWJlckxpbWl0XSBtYXhpbXVtIGFtb3VudCBvZiBmaWxlcyBwZXIgYWNjb3VudCwgZGVmYXVsdCB2YWx1ZSBpcyAxMlxuICogQHByb3BlcnR5IHtOdW1iZXJ9IFtsb2dGaWxlU2l6ZUluSG91cnNdIGFtb3VudCBvZiBsb2dnZWQgaG91cnMgcGVyIGFjY291bnQgZmlsZSwgZGVmYXVsdCB2YWx1ZSBpcyA0XG4gKiBAcHJvcGVydHkge0Jvb2xlYW59IFtjb21wcmVzc1NwZWNpZmljYXRpb25zXSB3aGV0aGVyIHRvIGNvbXByZXNzIHNwZWNpZmljYXRpb25zIHBhY2tldHMsIGRlZmF1bHQgdmFsdWUgaXMgdHJ1ZVxuICogQHByb3BlcnR5IHtCb29sZWFufSBbY29tcHJlc3NQcmljZXNdIHdoZXRoZXIgdG8gY29tcHJlc3Mgc3BlY2lmaWNhdGlvbnMgcGFja2V0cywgZGVmYXVsdCB2YWx1ZSBpcyB0cnVlXG4gKi9cblxuLyoqXG4gKiBBIGNsYXNzIHdoaWNoIHJlY29yZHMgcGFja2V0cyBpbnRvIGxvZyBmaWxlc1xuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYWNrZXRMb2dnZXIge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIHRoZSBjbGFzc1xuICAgKiBAcGFyYW0ge1BhY2tldExvZ2dlck9wdHN9IG9wdHMgcGFja2V0IGxvZ2dlciBvcHRpb25zXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRzKSB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gbmV3IE9wdGlvbnNWYWxpZGF0b3IoKTtcbiAgICBvcHRzID0gb3B0cyB8fCB7fTtcbiAgICB0aGlzLl9maWxlTnVtYmVyTGltaXQgPSB2YWxpZGF0b3IudmFsaWRhdGVOb25aZXJvKG9wdHMuZmlsZU51bWJlckxpbWl0LCAxMiwgJ3BhY2tldExvZ2dlci5maWxlTnVtYmVyTGltaXQnKTtcbiAgICB0aGlzLl9sb2dGaWxlU2l6ZUluSG91cnMgPSB2YWxpZGF0b3IudmFsaWRhdGVOb25aZXJvKG9wdHMubG9nRmlsZVNpemVJbkhvdXJzLCA0LFxuICAgICAgJ3BhY2tldExvZ2dlci5sb2dGaWxlU2l6ZUluSG91cnMnKTtcbiAgICB0aGlzLl9jb21wcmVzc1NwZWNpZmljYXRpb25zID0gdmFsaWRhdG9yLnZhbGlkYXRlQm9vbGVhbihvcHRzLmNvbXByZXNzU3BlY2lmaWNhdGlvbnMsIHRydWUsXG4gICAgICAncGFja2V0TG9nZ2VyLmNvbXByZXNzU3BlY2lmaWNhdGlvbnMnKTtcbiAgICB0aGlzLl9jb21wcmVzc1ByaWNlcyA9ICB2YWxpZGF0b3IudmFsaWRhdGVCb29sZWFuKG9wdHMuY29tcHJlc3NQcmljZXMsIHRydWUsICdwYWNrZXRMb2dnZXIuY29tcHJlc3NQcmljZXMnKTtcbiAgICB0aGlzLl9wcmV2aW91c1ByaWNlcyA9IHt9O1xuICAgIHRoaXMuX2xhc3RTTlBhY2tldCA9IHt9O1xuICAgIHRoaXMuX3dyaXRlUXVldWUgPSB7fTtcbiAgICB0aGlzLl9yb290ID0gJy4vLm1ldGFhcGkvbG9ncyc7XG4gICAgdGhpcy5fbG9nZ2VyID0gTG9nZ2VyTWFuYWdlci5nZXRMb2dnZXIoJ1BhY2tldExvZ2dlcicpO1xuICAgIGZzLmVuc3VyZURpcih0aGlzLl9yb290KTtcbiAgfVxuXG4gIF9lbnN1cmVQcmV2aW91c1ByaWNlT2JqZWN0KGFjY291bnRJZCkge1xuICAgIGlmKCF0aGlzLl9wcmV2aW91c1ByaWNlc1thY2NvdW50SWRdKSB7XG4gICAgICB0aGlzLl9wcmV2aW91c1ByaWNlc1thY2NvdW50SWRdID0ge307XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3NlcyBwYWNrZXRzIGFuZCBwdXNoZXMgdGhlbSBpbnRvIHNhdmUgcXVldWVcbiAgICogQHBhcmFtIHtPYmplY3R9IHBhY2tldCBwYWNrZXQgdG8gbG9nXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eVxuICBsb2dQYWNrZXQocGFja2V0KSB7XG4gICAgY29uc3QgaW5zdGFuY2VJbmRleCA9IHBhY2tldC5pbnN0YW5jZUluZGV4IHx8IDA7XG4gICAgaWYoIXRoaXMuX3dyaXRlUXVldWVbcGFja2V0LmFjY291bnRJZF0pIHtcbiAgICAgIHRoaXMuX3dyaXRlUXVldWVbcGFja2V0LmFjY291bnRJZF0gPSB7aXNXcml0aW5nOiBmYWxzZSwgcXVldWU6IFtdfTtcbiAgICB9XG4gICAgaWYocGFja2V0LnR5cGUgPT09ICdzdGF0dXMnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmKCF0aGlzLl9sYXN0U05QYWNrZXRbcGFja2V0LmFjY291bnRJZF0pIHtcbiAgICAgIHRoaXMuX2xhc3RTTlBhY2tldFtwYWNrZXQuYWNjb3VudElkXSA9IHt9O1xuICAgIH1cbiAgICBpZihbJ2tlZXBhbGl2ZScsICdub29wJ10uaW5jbHVkZXMocGFja2V0LnR5cGUpKSB7XG4gICAgICB0aGlzLl9sYXN0U05QYWNrZXRbcGFja2V0LmFjY291bnRJZF1baW5zdGFuY2VJbmRleF0gPSBwYWNrZXQ7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHF1ZXVlID0gdGhpcy5fd3JpdGVRdWV1ZVtwYWNrZXQuYWNjb3VudElkXS5xdWV1ZTtcbiAgICBpZighdGhpcy5fcHJldmlvdXNQcmljZXNbcGFja2V0LmFjY291bnRJZF0pIHtcbiAgICAgIHRoaXMuX3ByZXZpb3VzUHJpY2VzW3BhY2tldC5hY2NvdW50SWRdID0ge307XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHByZXZQcmljZSA9IHRoaXMuX3ByZXZpb3VzUHJpY2VzW3BhY2tldC5hY2NvdW50SWRdW2luc3RhbmNlSW5kZXhdO1xuICAgIFxuICAgIGlmKHBhY2tldC50eXBlICE9PSAncHJpY2VzJykge1xuICAgICAgaWYocHJldlByaWNlKSB7XG4gICAgICAgIHRoaXMuX3JlY29yZFByaWNlcyhwYWNrZXQuYWNjb3VudElkLCBpbnN0YW5jZUluZGV4KTtcbiAgICAgIH1cbiAgICAgIGlmKHBhY2tldC50eXBlID09PSAnc3BlY2lmaWNhdGlvbnMnICYmIHRoaXMuX2NvbXByZXNzU3BlY2lmaWNhdGlvbnMpIHtcbiAgICAgICAgcXVldWUucHVzaChKU09OLnN0cmluZ2lmeSh7dHlwZTogcGFja2V0LnR5cGUsIHNlcXVlbmNlTnVtYmVyOiBwYWNrZXQuc2VxdWVuY2VOdW1iZXIsIFxuICAgICAgICAgIHNlcXVlbmNlVGltZXN0YW1wOiBwYWNrZXQuc2VxdWVuY2VUaW1lc3RhbXAsIGluc3RhbmNlSW5kZXh9KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWV1ZS5wdXNoKEpTT04uc3RyaW5naWZ5KHBhY2tldCkpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZighdGhpcy5fY29tcHJlc3NQcmljZXMpIHtcbiAgICAgICAgcXVldWUucHVzaChKU09OLnN0cmluZ2lmeShwYWNrZXQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmKHByZXZQcmljZSkge1xuICAgICAgICAgIGNvbnN0IHZhbGlkU2VxdWVuY2VOdW1iZXJzID0gW3ByZXZQcmljZS5sYXN0LnNlcXVlbmNlTnVtYmVyLCBwcmV2UHJpY2UubGFzdC5zZXF1ZW5jZU51bWJlciArIDFdO1xuICAgICAgICAgIGlmKHRoaXMuX2xhc3RTTlBhY2tldFtwYWNrZXQuYWNjb3VudElkXVtpbnN0YW5jZUluZGV4XSkge1xuICAgICAgICAgICAgdmFsaWRTZXF1ZW5jZU51bWJlcnMucHVzaCh0aGlzLl9sYXN0U05QYWNrZXRbcGFja2V0LmFjY291bnRJZF1baW5zdGFuY2VJbmRleF0uc2VxdWVuY2VOdW1iZXIgKyAxKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoIXZhbGlkU2VxdWVuY2VOdW1iZXJzLmluY2x1ZGVzKHBhY2tldC5zZXF1ZW5jZU51bWJlcikpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlY29yZFByaWNlcyhwYWNrZXQuYWNjb3VudElkLCBpbnN0YW5jZUluZGV4KTtcbiAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVByZXZpb3VzUHJpY2VPYmplY3QocGFja2V0LmFjY291bnRJZCk7XG4gICAgICAgICAgICB0aGlzLl9wcmV2aW91c1ByaWNlc1twYWNrZXQuYWNjb3VudElkXVtpbnN0YW5jZUluZGV4XSA9IHtmaXJzdDogcGFja2V0LCBsYXN0OiBwYWNrZXR9O1xuICAgICAgICAgICAgcXVldWUucHVzaChKU09OLnN0cmluZ2lmeShwYWNrZXQpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fcHJldmlvdXNQcmljZXNbcGFja2V0LmFjY291bnRJZF1baW5zdGFuY2VJbmRleF0ubGFzdCA9IHBhY2tldDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fZW5zdXJlUHJldmlvdXNQcmljZU9iamVjdChwYWNrZXQuYWNjb3VudElkKTtcbiAgICAgICAgICB0aGlzLl9wcmV2aW91c1ByaWNlc1twYWNrZXQuYWNjb3VudElkXVtpbnN0YW5jZUluZGV4XSA9IHtmaXJzdDogcGFja2V0LCBsYXN0OiBwYWNrZXR9O1xuICAgICAgICAgIHF1ZXVlLnB1c2goSlNPTi5zdHJpbmdpZnkocGFja2V0KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBsb2cgbWVzc2FnZXMgd2l0aGluIGRhdGUgYm91bmRzIGFzIGFuIGFycmF5IG9mIG9iamVjdHNcbiAgICogQHBhcmFtIHtTdHJpbmd9IGFjY291bnRJZCBhY2NvdW50IGlkIFxuICAgKiBAcGFyYW0ge0RhdGV9IGRhdGVBZnRlciBkYXRlIHRvIGdldCBsb2dzIGFmdGVyXG4gICAqIEBwYXJhbSB7RGF0ZX0gZGF0ZUJlZm9yZSBkYXRlIHRvIGdldCBsb2dzIGJlZm9yZVxuICAgKiBAcmV0dXJucyB7QXJyYXk8T2JqZWN0Pn0gbG9nIG1lc3NhZ2VzXG4gICAqL1xuICBhc3luYyByZWFkTG9ncyhhY2NvdW50SWQsIGRhdGVBZnRlciwgZGF0ZUJlZm9yZSkge1xuICAgIGNvbnN0IGZvbGRlcnMgPSBhd2FpdCBmcy5yZWFkZGlyKHRoaXMuX3Jvb3QpO1xuICAgIGNvbnN0IHBhY2tldHMgPSBbXTtcblxuICAgIGZvciAobGV0IGZvbGRlciBvZiBmb2xkZXJzKSB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGAke3RoaXMuX3Jvb3R9LyR7Zm9sZGVyfS8ke2FjY291bnRJZH0ubG9nYDtcbiAgICAgIGlmKGF3YWl0IGZzLnBhdGhFeGlzdHMoZmlsZVBhdGgpKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnRzID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgsICd1dGY4Jyk7XG4gICAgICAgIGxldCBtZXNzYWdlcyA9IGNvbnRlbnRzLnNwbGl0KCdcXHJcXG4nKS5maWx0ZXIobWVzc2FnZSA9PiBtZXNzYWdlLmxlbmd0aCkubWFwKG1lc3NhZ2UgPT4ge1xuICAgICAgICAgIHJldHVybiB7ZGF0ZTogbmV3IERhdGUobWVzc2FnZS5zbGljZSgxLCAyNCkpLCBtZXNzYWdlOiBtZXNzYWdlLnNsaWNlKDI2KX07XG4gICAgICAgIH0pO1xuICAgICAgICBpZihkYXRlQWZ0ZXIpIHtcbiAgICAgICAgICBtZXNzYWdlcyA9IG1lc3NhZ2VzLmZpbHRlcihtZXNzYWdlID0+IG1lc3NhZ2UuZGF0ZSA+IGRhdGVBZnRlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZGF0ZUJlZm9yZSkge1xuICAgICAgICAgIG1lc3NhZ2VzID0gbWVzc2FnZXMuZmlsdGVyKG1lc3NhZ2UgPT4gbWVzc2FnZS5kYXRlIDwgZGF0ZUJlZm9yZSk7XG4gICAgICAgIH1cbiAgICAgICAgcGFja2V0cy5wdXNoKC4uLm1lc3NhZ2VzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcGFja2V0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHBhdGggZm9yIGFjY291bnQgbG9nIGZpbGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGFjY291bnRJZCBhY2NvdW50IGlkXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IGZpbGUgcGF0aFxuICAgKi9cbiAgYXN5bmMgZ2V0RmlsZVBhdGgoYWNjb3VudElkKSB7XG4gICAgY29uc3QgZmlsZUluZGV4ID0gTWF0aC5mbG9vcihuZXcgRGF0ZSgpLmdldEhvdXJzKCkgLyB0aGlzLl9sb2dGaWxlU2l6ZUluSG91cnMpO1xuICAgIGNvbnN0IGZvbGRlck5hbWUgPSBgJHttb21lbnQoKS5mb3JtYXQoJ1lZWVktTU0tREQnKX0tJHtmaWxlSW5kZXggPiA5ID8gZmlsZUluZGV4IDogJzAnICsgZmlsZUluZGV4fWA7XG4gICAgYXdhaXQgZnMuZW5zdXJlRGlyKGAke3RoaXMuX3Jvb3R9LyR7Zm9sZGVyTmFtZX1gKTtcbiAgICByZXR1cm4gYCR7dGhpcy5fcm9vdH0vJHtmb2xkZXJOYW1lfS8ke2FjY291bnRJZH0ubG9nYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgcGFja2V0IGxvZ2dlclxuICAgKi9cbiAgc3RhcnQoKSB7XG4gICAgdGhpcy5fcHJldmlvdXNQcmljZXMgPSB7fTtcbiAgICBpZiAoIXRoaXMuX3JlY29yZEludGV2YWwpIHtcbiAgICAgIHRoaXMuX3JlY29yZEludGV2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLl9hcHBlbmRMb2dzKCksIDEwMDApO1xuICAgICAgdGhpcy5fZGVsZXRlT2xkTG9nc0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy5fZGVsZXRlT2xkRGF0YSgpLCAxMDAwMCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlaW5pdGlhbGl6ZXMgdGhlIHBhY2tldCBsb2dnZXJcbiAgICovXG4gIHN0b3AoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9yZWNvcmRJbnRldmFsKTtcbiAgICBjbGVhckludGVydmFsKHRoaXMuX2RlbGV0ZU9sZExvZ3NJbnRlcnZhbCk7XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkcyBwcmljZSBwYWNrZXQgbWVzc2FnZXMgdG8gbG9nIGZpbGVzXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBhY2NvdW50SWQgYWNjb3VudCBpZFxuICAgKi9cbiAgX3JlY29yZFByaWNlcyhhY2NvdW50SWQsIGluc3RhbmNlTnVtYmVyKSB7XG4gICAgY29uc3QgcHJldlByaWNlID0gdGhpcy5fcHJldmlvdXNQcmljZXNbYWNjb3VudElkXVtpbnN0YW5jZU51bWJlcl0gfHwge2ZpcnN0OiB7fSwgbGFzdDp7fX07XG4gICAgY29uc3QgcXVldWUgPSB0aGlzLl93cml0ZVF1ZXVlW2FjY291bnRJZF0ucXVldWU7XG4gICAgZGVsZXRlIHRoaXMuX3ByZXZpb3VzUHJpY2VzW2FjY291bnRJZF1baW5zdGFuY2VOdW1iZXJdO1xuICAgIGlmKCFPYmplY3Qua2V5cyh0aGlzLl9wcmV2aW91c1ByaWNlc1thY2NvdW50SWRdKS5sZW5ndGgpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLl9wcmV2aW91c1ByaWNlc1thY2NvdW50SWRdO1xuICAgIH1cbiAgICBpZihwcmV2UHJpY2UuZmlyc3Quc2VxdWVuY2VOdW1iZXIgIT09IHByZXZQcmljZS5sYXN0LnNlcXVlbmNlTnVtYmVyKSB7XG4gICAgICBxdWV1ZS5wdXNoKEpTT04uc3RyaW5naWZ5KHByZXZQcmljZS5sYXN0KSk7XG4gICAgICBxdWV1ZS5wdXNoKGBSZWNvcmRlZCBwcmljZSBwYWNrZXRzICR7cHJldlByaWNlLmZpcnN0LnNlcXVlbmNlTnVtYmVyfWAgK1xuICAgICAgICBgLSR7cHJldlByaWNlLmxhc3Quc2VxdWVuY2VOdW1iZXJ9LCBpbnN0YW5jZUluZGV4OiAke2luc3RhbmNlTnVtYmVyfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBXcml0ZXMgbG9ncyB0byBmaWxlc1xuICAgKi9cbiAgYXN5bmMgX2FwcGVuZExvZ3MoKSB7XG4gICAgT2JqZWN0LmtleXModGhpcy5fd3JpdGVRdWV1ZSkuZm9yRWFjaChhc3luYyBhY2NvdW50SWQgPT4ge1xuICAgICAgY29uc3QgcXVldWUgPSB0aGlzLl93cml0ZVF1ZXVlW2FjY291bnRJZF07XG4gICAgICBpZiAoIXF1ZXVlLmlzV3JpdGluZyAmJiBxdWV1ZS5xdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgcXVldWUuaXNXcml0aW5nID0gdHJ1ZTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGF3YWl0IHRoaXMuZ2V0RmlsZVBhdGgoYWNjb3VudElkKTtcbiAgICAgICAgICBjb25zdCB3cml0ZVN0cmluZyA9IHF1ZXVlLnF1ZXVlLnJlZHVjZSgoYSxiKSA9PiBhICsgXG4gICAgICAgICAgYFske21vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcy5TU1MnKX1dICR7Yn1cXHJcXG5gICwnJyk7XG4gICAgICAgICAgcXVldWUucXVldWUgPSBbXTtcbiAgICAgICAgICBhd2FpdCBmcy5hcHBlbmRGaWxlKGZpbGVQYXRoLCB3cml0ZVN0cmluZyk7ICBcbiAgICAgICAgfSBjYXRjaChlcnIpIHtcbiAgICAgICAgICB0aGlzLl9sb2dnZXIuZXJyb3IoYCR7YWNjb3VudElkfTogRmFpbGVkIHRvIHJlY29yZCBwYWNrZXQgbG9nYCwgZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBxdWV1ZS5pc1dyaXRpbmcgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGZvbGRlcnMgd2hlbiB0aGUgZm9sZGVyIGxpbWl0IGlzIGV4Y2VlZGVkXG4gICAqL1xuICBhc3luYyBfZGVsZXRlT2xkRGF0YSgpIHtcbiAgICBjb25zdCBjb250ZW50cyA9IGF3YWl0IGZzLnJlYWRkaXIodGhpcy5fcm9vdCk7XG4gICAgY29udGVudHMucmV2ZXJzZSgpLnNsaWNlKHRoaXMuX2ZpbGVOdW1iZXJMaW1pdCkuZm9yRWFjaChhc3luYyBmb2xkZXJOYW1lID0+IHtcbiAgICAgIGF3YWl0IGZzLnJlbW92ZShgJHt0aGlzLl9yb290fS8ke2ZvbGRlck5hbWV9YCk7IFxuICAgIH0pO1xuICB9XG5cbn1cbiJdLCJuYW1lcyI6WyJQYWNrZXRMb2dnZXIiLCJfZW5zdXJlUHJldmlvdXNQcmljZU9iamVjdCIsImFjY291bnRJZCIsIl9wcmV2aW91c1ByaWNlcyIsImxvZ1BhY2tldCIsInBhY2tldCIsImluc3RhbmNlSW5kZXgiLCJfd3JpdGVRdWV1ZSIsImlzV3JpdGluZyIsInF1ZXVlIiwidHlwZSIsIl9sYXN0U05QYWNrZXQiLCJpbmNsdWRlcyIsInByZXZQcmljZSIsIl9yZWNvcmRQcmljZXMiLCJfY29tcHJlc3NTcGVjaWZpY2F0aW9ucyIsInB1c2giLCJKU09OIiwic3RyaW5naWZ5Iiwic2VxdWVuY2VOdW1iZXIiLCJzZXF1ZW5jZVRpbWVzdGFtcCIsIl9jb21wcmVzc1ByaWNlcyIsInZhbGlkU2VxdWVuY2VOdW1iZXJzIiwibGFzdCIsImZpcnN0IiwicmVhZExvZ3MiLCJkYXRlQWZ0ZXIiLCJkYXRlQmVmb3JlIiwiZm9sZGVycyIsImZzIiwicmVhZGRpciIsIl9yb290IiwicGFja2V0cyIsImZvbGRlciIsImZpbGVQYXRoIiwicGF0aEV4aXN0cyIsImNvbnRlbnRzIiwicmVhZEZpbGUiLCJtZXNzYWdlcyIsInNwbGl0IiwiZmlsdGVyIiwibWVzc2FnZSIsImxlbmd0aCIsIm1hcCIsImRhdGUiLCJEYXRlIiwic2xpY2UiLCJnZXRGaWxlUGF0aCIsImZpbGVJbmRleCIsIk1hdGgiLCJmbG9vciIsImdldEhvdXJzIiwiX2xvZ0ZpbGVTaXplSW5Ib3VycyIsImZvbGRlck5hbWUiLCJtb21lbnQiLCJmb3JtYXQiLCJlbnN1cmVEaXIiLCJzdGFydCIsIl9yZWNvcmRJbnRldmFsIiwic2V0SW50ZXJ2YWwiLCJfYXBwZW5kTG9ncyIsIl9kZWxldGVPbGRMb2dzSW50ZXJ2YWwiLCJfZGVsZXRlT2xkRGF0YSIsInN0b3AiLCJjbGVhckludGVydmFsIiwiaW5zdGFuY2VOdW1iZXIiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsIndyaXRlU3RyaW5nIiwicmVkdWNlIiwiYSIsImIiLCJhcHBlbmRGaWxlIiwiZXJyIiwiX2xvZ2dlciIsImVycm9yIiwicmV2ZXJzZSIsIl9maWxlTnVtYmVyTGltaXQiLCJyZW1vdmUiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJ2YWxpZGF0b3IiLCJPcHRpb25zVmFsaWRhdG9yIiwidmFsaWRhdGVOb25aZXJvIiwiZmlsZU51bWJlckxpbWl0IiwibG9nRmlsZVNpemVJbkhvdXJzIiwidmFsaWRhdGVCb29sZWFuIiwiY29tcHJlc3NTcGVjaWZpY2F0aW9ucyIsImNvbXByZXNzUHJpY2VzIiwiTG9nZ2VyTWFuYWdlciIsImdldExvZ2dlciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7ZUFtQnFCQTs7O2dFQWxCTjsrREFDSTt5RUFDVTsrREFDSDs7Ozs7O0FBZVgsSUFBQSxBQUFNQSxlQUFOLE1BQU1BO0lBdUJuQkMsMkJBQTJCQyxTQUFTLEVBQUU7UUFDcEMsSUFBRyxDQUFDLElBQUksQ0FBQ0MsZUFBZSxDQUFDRCxVQUFVLEVBQUU7WUFDbkMsSUFBSSxDQUFDQyxlQUFlLENBQUNELFVBQVUsR0FBRyxDQUFDO1FBQ3JDO0lBQ0Y7SUFFQTs7O0dBR0MsR0FDRCxzQ0FBc0M7SUFDdENFLFVBQVVDLE1BQU0sRUFBRTtRQUNoQixNQUFNQyxnQkFBZ0JELE9BQU9DLGFBQWEsSUFBSTtRQUM5QyxJQUFHLENBQUMsSUFBSSxDQUFDQyxXQUFXLENBQUNGLE9B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